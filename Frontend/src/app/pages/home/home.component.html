<div class="container">
  <!-- SE DIPENDENTE: mostra titolo e pulsante "Nuova richiesta" -->
  <div class="header" *ngIf="userRole === 'dipendente'">
    <h2>Lista richieste permesso</h2>
    <button
      mat-raised-button
      color="primary"
      class="add-button"
      (click)="onAdd()"
    >
      <mat-icon>add</mat-icon> Nuova richiesta
    </button>
  </div>

  <!-- SE RESPONSABILE: mostra titolo specifico -->
  <div class="header" *ngIf="userRole === 'responsabile'">
    <h2>Elenco richieste in attesa di approvazione</h2>
  </div>

  <mat-progress-spinner
    *ngIf="loading"
    mode="indeterminate"
  ></mat-progress-spinner>

  <!-- Se caricato e non ci sono richieste -->
  <div *ngIf="!loading && richieste.length === 0" class="empty">
    <ng-container *ngIf="userRole === 'dipendente'">
      Nessuna richiesta disponibile.
    </ng-container>
    <ng-container *ngIf="userRole === 'responsabile'">
      Nessuna richiesta da approvare.
    </ng-container>
  </div>

  <!-- Lista delle richieste (sia per dipendente, sia per responsabile) -->
  <div class="lista-richieste" *ngIf="!loading && richieste.length > 0">
    <mat-card *ngFor="let r of richieste" class="richiesta-card">
      <mat-card-header>
        <mat-card-title>{{
          r.categoriaId.descrizione || r.categoriaId
        }}</mat-card-title>
        <mat-chip
          [style.background-color]="getStatoColor(r.stato)"
          class="stato-chip"
        >
          {{ r.stato }}
        </mat-chip>
      </mat-card-header>
      <mat-card-content>
        <p><strong>Motivazione:</strong> {{ r.motivazione }}</p>
        <p>
          <strong>Periodo:</strong> {{ formatDate(r.dataInizio) }} â€“
          {{ formatDate(r.dataFine) }}
        </p>
        <p>
          <strong>Data richiesta:</strong> {{ formatDate(r.dataRichiesta) }}
        </p>
      </mat-card-content>

      <!-- Pulsanti visibili solo se DIPENDENTE e richiesta "In attesa" -->
      <mat-card-actions
        *ngIf="userRole === 'dipendente' && r.stato === 'In attesa'"
        class="actions"
      >
        <button
          mat-icon-button
          color="primary"
          aria-label="Modifica richiesta"
          (click)="onEdit(r)"
        >
          <mat-icon>edit</mat-icon>
        </button>
        <button
          mat-icon-button
          color="warn"
          aria-label="Elimina richiesta"
          (click)="onDelete(r)"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-card-actions>

      <!-- Pulsanti visibili solo se RESPONSABILE e richiesta "In attesa" -->
      <mat-card-actions
        *ngIf="userRole === 'responsabile' && r.stato === 'In attesa'"
        class="actions"
      >
        <button mat-button color="primary" (click)="onApprove(r)">
          <mat-icon>check_circle</mat-icon> Approva
        </button>
        <button mat-button color="warn" (click)="onReject(r)">
          <mat-icon>cancel</mat-icon> Rifiuta
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
